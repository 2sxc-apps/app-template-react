@inherits Custom.Hybrid.RazorTyped
@using AppCode.Editions
@using AppCode.React
@using ToSic.Sxc.Services;
@using ToSic.Razor.Blade;

@{
  var moduleId = MyContext.Module.Id;

  // Enable 2sic JS APIs (this will load the latest js-api to help with getting data from 2sxc data base)
  var page = GetService<IPageService>();
  page.Activate("2sxc.JsCore");

  // Add <base> tag using RazorBlade - TODO: Check if needed
  HtmlPage.AddBase((Link.Base()));

  // Create helper to manage the editions (live, staging etc.)
  var editions = GetService<Editions>();

  // Create helper to integrate react best-practice
  var ngHelpers = GetService<React>();

  // Show React either from dev (local) or from the compiled live/staging folders
  if (editions.CurrentEdition == "local")
  {
    @Html.Partial("ReactApp.PartLocalAssets.cshtml")
  }
  else
  {
    @Html.Raw(ngHelpers.ImportReactHtml(editions.CurrentEdition));

    // Add the root div with the moduleId to the page
    <div id="root-@moduleId"></div>
  }

  // Show edition selector for host/super users only - you could also change this, to allow testers to see this *@
  if (MyUser.IsContentAdmin)
  {
    @Html.Partial("ReactApp.PartEditions.cshtml", new { Editions = "live,staging,local" })
  }
}

<script>
  document.addEventListener("DOMContentLoaded", function() {
    window.reactAppMain && window.reactAppMain(@moduleId);
  });
</script>